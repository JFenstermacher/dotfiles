#!/usr/bin/env bash

# Source utils
source "$(dirname "$0")/scripts/utils.sh"

# Installs Mise if not installed
if ! command -v mise &>/dev/null; then
  log_info "Installing Mise..."
  curl https://mise.run | sh
  export PATH="$HOME/.local/bin:$PATH"
else
  log_info "Mise is already installed"
fi

# Install TPM (Tmux Plugin Manager)
if [ ! -d "$HOME/.tmux/plugins/tpm" ]; then
  log_info "Installing Tmux Plugin Manager..."
  git clone https://github.com/tmux-plugins/tpm "$HOME/.tmux/plugins/tpm"
  log_info "Installing tmux plugins..."
  "$HOME/.tmux/plugins/tpm/bin/install_plugins"
else
  log_info "Tmux Plugin Manager is already installed"
fi

# Install dotfile dependencies
mise install

# Run mise install in current directory
log_info "Linking all dotfiles"
mise stow

# Global mise tools now installed
log_info "Installing all tools"
mise install
