#!/bin/sh

# For first time stow, sample command
# stow -t ~ bin

DOTFILES_DIR=$( git rev-parse --show-toplevel )

STOW_ARGS="-d $DOTFILES_DIR -t $HOME"
ACTION="stow"

# Unstow by passing -D as first arg
if [[ "$1" == "-D" ]]; then
  STOW_ARGS="$STOW_ARGS -D"
  ACTION="unstow"
  shift
fi

# Must specify at least one directory
if [[ "$#" -eq 0 ]]; then
  echo "[ERROR] Please specify one or more dotfiles to $ACTION"
  exit 1
fi

TO_STOW=()

# Determining which directories to stow
for dir in "$@"; do
  if [ ! -d "$DOTFILES_DIR/$dir" ]; then
    echo "[WARN] '$dir' doesn't exist. Skipping."
  else
    TO_STOW+=($dir)
  fi
done

# Stow directory
echo "[INFO] ${ACTION^^}ING modules"
for dir in "${TO_STOW[@]}"; do
  echo "[INFO]   - $dir"
  stow $STOW_ARGS $dir
done
