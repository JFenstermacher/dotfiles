#!/usr/bin/env bash

# Get username for session name
USER_SESSION=$(whoami)

# Function to create user session if it doesn't exist
create_user_session() {
  if ! tmux list-sessions | grep -q "^${USER_SESSION}:"; then
    tmux new-session -d -s "$USER_SESSION" -c "$HOME"
  fi
}

# Function to switch to or attach to user session
switch_or_attach() {
  if [ -n "$TMUX" ]; then
    # Within tmux, switch to user session
    create_user_session
    tmux switch-client -t "$USER_SESSION"
  else
    # Outside tmux, attach to user session
    if tmux list-sessions >/dev/null 2>&1; then
      # Tmux server is running
      create_user_session
      tmux attach-session -t "$USER_SESSION"
    else
      # Tmux server not running, start it with user session
      tmux new-session -s "$USER_SESSION" -c "$HOME"
    fi
  fi
}

# Main execution
switch_or_attach
